# 2.5.1. Terminology

- URLは、WHATWG URL仕様のオーサリング適合性要件に準拠する場合、有効なURLです。
    - [URL](https://www.w3.org/TR/html/references.html#biblio-url)
- 有効なURLで空の文字列では無い場合、有効な空ではないURLです
- スペースに囲まれた有効なURLは前後のスペースをトリムした後、有効なURLになり得ます
- スペースに囲まれた有効な空ではないURLは前後のスペースをトリムした後、有効な空ではないURLになり得ます
- この仕様書はURL about:legacy-compatを、予約語として定義していますが、解決できないため、about:URLを使用することがXMLツールとの互換性のためにHTMLドキュメントのDOCTYPEで必要です。
- この仕様書はURL about:html-kindを、予約語として定義していますが、解決できないため、about:URLがメディアトラックの種類のアイデンティファイアとして使っています。
- この仕様書はURL about:srcdocを、予約語として定義していますが、解決できないため、about:URLがiframe srcdoc のドキュメントのURLが使われています。

- DocumentオブジェクトのフォールバックベースURLは、これらのサブステップを実行することによって取得される絶対URLです。
    1. documentがiframe srcdocドキュメントの場合、ドキュメントのブラウズコンテキストのブラウズコンテキストコンテナのノードドキュメントのドキュメントのベースURLを返します。
    2. ドキュメントのURLがabout:blankでドキュメントのブラウジングコンテキストがクリエータブラウジングコンテキストを持つ場合、クリエータベースURLを返します。
    3. ドキュメントのURLを返します

- ドキュメントオブジェクトのドキュメントベースURLは以下のサブステップで得られる絶対URLです。
    1. ドキュメントに`href`属性のある`base`要素が無い場合、ドキュメントベースURLはドキュメントのフォールバックURLで、これらのステップを中断します
    2. それ以外の場合、ドキュメントベースURLはツリー構造内のドキュメントの最初の`href`属性のある`base`要素のフローズンベースURLです。

# 2.5.2. Parsing URLs

- URLの解析は、URL文字列を取得し、それが意味するURLレコードを取得するプロセスです。
- このプロセスはWHATWG URL仕様で定義されていますが、この仕様では便宜のためにラッパーを定義しています。
    - [URL](https://www.w3.org/TR/html/references.html#biblio-url)

- note
    - このラッパーは、歴史的な理由から、URLパーサーの文字エンコーディングがドキュメントか環境設定オブジェクトと一致する必要がある場合にのみ有効です。
    - そうでない場合、URLパーサーを直接使用することができます。

- ドキュメントか環境設定オブジェクトに関連したURL urlを解析するには、ユーザーエージェントは次の手順を使用する必要があります。
- URLを解析すると、失敗または結果のURL文字列と結果のURLレコードが返されます。
    1. エンコーディングをドキュメントの文字エンコーディングに、ドキュメントが与えられている場合設定環境オブジェクトのAPI URL文字エンコードとします
    2. baseURLをドキュメントのベースURL、ドキュメントが与えられていれば環境設定オブジェクトのAPIベースURLとする。
    3. urlRecordは、urlにbaseURLとエンコーディングでURLパーサーを適用した結果とします。
    4. urlRecordが失敗した場合は、これらの手順をエラーで中止します。
    5. URLシリアライザをurlRecordに適用した結果をurlStringにします。
    6. 結果のURL文字列としてurlStringを返し、結果のURLレコードとしてurlRecordを返します。


# 2.5.3. Dynamic changes to base URLs

- ドキュメントのドキュメントベースURLが変更されると、そのドキュメントのすべての要素はベースURLの変更の影響を受けます。
- 以下は、エレメントがベースURLの変更（DOM仕様で定義）の影響を受けたときに実行されるベースURL変更ステップです。

- 要素がハイパーリンクを作成する場合
    - ハイパーリンクによって識別されたURLがユーザーに表示されている場合や、そのURLから派生したデータが表示に影響を与えている場合は、href属性を要素のノード文書に対して再解析し、UIを適切に更新する必要があります。
    - 例:24
        - cssの`:link`, `:visited`, 代理クラスは、影響がある可能性があります

- `cite`属性を持つ`q`, `blockquote`, `ins`, `del`要素の場合
    - `cite`属性で識別されるURLがユーザーに表示されている場合、またはそのURLから派生したデータが表示に影響を与えている場合、URLは要素のノード文書に関連して再解析され、UIは適切に更新されます。

- それ以外の場合
    - 要素は直接影響しません
    - 例:25
        - 例えば、ベースURLを変更してもimg要素で表示されるイメージには影響しません。
        - ただし、スクリプトからのsrc IDL属性のその後のアクセスは、表示されるイメージに対応しなくなるかもしれない新しい絶対URLを返します。
