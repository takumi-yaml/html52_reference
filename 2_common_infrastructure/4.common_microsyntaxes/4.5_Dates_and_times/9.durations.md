# 2.4.5.9. Durations

- 期間は秒数で構成されます。

- note:
    - 月と秒は比較できないので(月は正確な秒数ではなく、その正確な長さが測定された正確な日に依存する期間です)、この仕様で定義されている期間には月を含めることはできません(または12ヶ月に相当する年)
    - 特定の秒数で説明できる期間のみを説明することができます。

- 文字列は、次のいずれかで構成される場合、期間tを表す有効な期間文字列です
    - リテラルU+0050 LATIN CAPITAL LETTER P文字の後に、次の1つ以上のサブコンポーネントが指定された順序で続きます。
        - ここで、日数、時間、分、秒はtと同じ秒数に対応します。

1. 1つ以上のASCII数字の後にU+0044 LATIN大文字のD文字が続き、日数を表します。
2. U+0054 LATIN CAPITAL LETTER T文字の後に、次のサブコンポーネントの1つ以上が指定された順序で続きます。
    1. 1つ以上のASCII数字の後にU+0048 LATIN大文字H文字が続き、時間数を表します。
    2. 1つ以上のASCII数字の後にU+004D LATIN CAPITAL LETTER M文字が続き、分数を表します。
    3. 次のコンポーネント：
        1. 1つ以上のASCII数字で、秒数を表します。
        2. オプションで、U+002E FULL STOP文字（.）の後に1,2、または3つのASCII桁が続き、分数秒を表します。
        3. U+0053ラテン大文字S文字。

- note
    - これは、この仕様書で定義されている他の多くの日時関連のマイクロシンタックスと同様に、ISO 8601で定義された形式の1つに基づいています。
        - [ISO8601](https://www.w3.org/TR/html/references.html#biblio-iso8601)

- 任意の順序で異なる期間コンポーネントスケールを有する1つまたは複数の期間コンポーネント、表された秒の合計はtの秒数に等しい。


- 期間コンポーネントは、次のコンポーネントで構成される文字列です。
    1. ゼロ個以上のスペース文字。
    2. 指定された期間コンポーネントのスケール（下記参照）でスケーリングされ、秒数を表す1つまたは複数のASCII数字。
    3. 指定された期間コンポーネントスケールが1である場合（すなわち、単位が秒である場合）、オプションで、U+002Eフルストップ文字(.)の後に1,2または3のASCII数字が続きます。
    4. ゼロ個以上のスペース文字。
    5. 期間コンポーネントの数値部分で使用される時間単位の期間コンポーネントのスケールを表す、次の文字の1つ。
        - 週。U+0057ラテン大文字W文字 / U+0077ラテン小文字Wキャラクター スケールは604800です。
        - 日 U+0044 LATIN大文字D文字 U+0064ラテン小文字D文字 スケールは86400です。
        - 時 U+0048 LATIN CAPITAL LETTER Hキャラクター U+0068ラテン小文字Hキャラクター スケールは3600です。
        - 分 U+004Dラテン大文字M文字 U+006Dラテン小文字M文字 スケールは60です。
        - 秒 U+0053ラテン大文字S文字 U+0073ラテン小文字S文字 スケールは1です。
    6. 0以上のスペース文字

- note
    - これは、ISO 8601のフォーマットに基づいていません。これは、ISO 8601の期間フォーマットの代わりに人が読めるように意図されています


- 期間文字列を解析するルールは次のとおりです。これは期間または何も返しません。
    - アルゴリズムがfailの場合は、その時点で中止され、何も返されないことを意味します。

1. inputを解析対象の文字列とします。
2. positionをinputへのポインタとし、最初は文字列の先頭を指します。
3. 月、秒、コンポーネント数をすべてゼロにします。
4. Mを分とする。
    - note
        - このフラグの他の値は月です。
        - ISO8601の期間内に「M」ユニット、月と分のために同じユニットが使われる、を明確にするために使用されます。。
        - 月は許可されませんが、将来の互換性のために解析され、他のコンテキストで有効であるISO8601の期間を誤解させないようにします。
5. 空白をスキップします
6. positionが入力の最後を過ぎている場合、failです
7. positionで指し示された文字がU+0050 LATIN CAPITAL LETTER P文字の場合、次の文字に進み、Mを月に設定し、空白をスキップします。
8. ループが終了するか、アルゴリズム全体が失敗するまで、次のサブステップをループ内で実行します。
    1. 単位を未定義にします。年、月、週、日、時、分、秒のいずれかの値が割り当てられます。
    2. 次の文字は未定義にします。入力から文字を処理するために使用されます。
    3. positionがinputの最後を過ぎている場合は、ループを終了します。
    4. positionが指し示すinputの中の文字がU+0054ラテン大文字T文字である場合、位置を次の文字に進め、Mを分に設定し、空白をスキップしてループの先頭に戻ります。
    5. positionが指すinputの文字に次の文字を設定します。
    6. 次の文字がU+002E FULL STOP文字（.）の場合、Nをゼロにします。
        - ポジションを進めないでください。それは以下で扱われます。
    7. positionがinputの最後を過ぎている場合、failです
    8. 次の文字を、positionが指すinputの文字に設定し、この時、positionを次の文字に進めます。
    9. 次の文字がU+002E FULL STOP文字（.）の場合は、次のサブステップを実行します。
        1. ASCII数字である一連の文字を収集します。結果のシーケンスをsとする。
        2. sが空文字列の場合、failです。
        3. 長さをsの文字数とする。
        4. fractionをsを基数10の整数として解釈し、その数を10の長さで割った結果とする。
        5. 分数でNをインクリメントします。
        6. 空白を飛ばします。
        7. positionが入力の最後を過ぎている場合、failです
        8. positionが指し示すinput内の文字を次の文字を設定し、positionを次の文字に進めます。
        9. 次の文字がU+0050 LATIN大文字S文字でもU+0073 LATIN SMALL LETTER S文字でもない場合、failです
        10. ユニットを秒に設定します。
        - それ以外の場合は、次のサブステップを実行します。
            1. 次の文字が空白文字の場合は、空白をスキップし、次の文字をinputのpositionで指定されている文字に設定し、positionを次の文字に進めます。
            2.
                - 次の文字がU+0059ラテン大文字Y文字またはU+0079ラテン小文字Y文字の場合は、単位を年に設定し、Mを月に設定します。
                - 次の文字がU+004D LATIN大文字M文字またはU+006D LATIN小文字M文字で、Mが月の場合、単位を月に設定します。
                - 次の文字がU+0057 LATIN大文字W文字またはU+0077 LATIN小文字W文字の場合は、単位を週に設定し、Mを分に設定します。
                - 次の文字がU+0044 LATIN大文字D文字またはU+0064 LATIN小文字D文字の場合は、単位を日に設定し、Mを分に設定します。
                - 次の文字がU+0048 LATIN大文字H文字またはU+0068 LATIN小文字H文字の場合は、単位を時間に設定し、Mを分に設定します。
                - 次の文字がU+004D LATIN大文字M文字またはU+006D LATIN小文字M文字で、Mが分の場合は、単位を分に設定します。
                - 次の文字がU+0053ラテン大文字S文字またはU+0073ラテン小文字S文字の場合は、単位を秒に設定し、Mを分に設定します。
    10. コンポーネント数をインクリメントします。
    11. 乗数を1にする。
    12. 単位が年の場合は、乗数に12を掛け、単位を月に設定します。
    13. 単位が月の場合は、Nと乗数の積を月に加算します。
        - それ以外の場合は、次のサブステップを実行します。
            1. 単位が週の場合は、乗数に7を掛け、単位を日に設定します。
            2. 単位が日であれば、乗数に24を掛け、単位を時間に設定します。
            3. 単位が時間である場合は、乗数に60を掛け、単位を分に設定します。
            4. 単位が分の場合は、乗数に60を掛け、単位を秒に設定します。
            5. 強制的に、単位は秒です。 Nと乗数の積を秒に加算する。
    14. 空白を飛ばします。
9. コンポーネント数がゼロの場合、failです
10. 月がゼロでない場合、failです
11. 秒からなる期間を返します。
