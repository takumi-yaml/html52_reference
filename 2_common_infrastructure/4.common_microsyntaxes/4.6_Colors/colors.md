# 2.4.6. Colors

- 単色は、sRGB色空間の色の赤、緑、青の各成分を表す0..255の範囲内の3つの8ビット数で構成されています。
    - [SRGP](https://www.w3.org/TR/html/references.html#biblio-srgb)

- 文字列が正確に7文字で、最初の文字がU+0023 NUMBER SIGN文字（#）である場合、文字列は有効な単純色です。
    - 残りの6文字はすべてASCIIの16進数で、最初の2桁は赤色の構成要素を表し、中央の2桁は緑色の構成要素を表し、最後の2桁は青色構成要素を表す16進数を表します。

- 有効な単純色で、U+0041LATIN CAPITAL LETTER AからU + 0046 LATIN CAPITAL LETTER Fの範囲の文字を使用しない場合、文字列は有効な小文字のシンプルな色です。

- 単純色の値を解析するための規則は、次のアルゴリズムで与えられているとおりです。
    - 呼び出されると、指定された順序でステップを実行し、値を返す最初のステップで中止しなければなりません。このアルゴリズムは、単純色かエラーのいずれかを返します。

1. inputを解析対象の文字列とします。
2. 入力が正確に7文字でない場合は、エラーを返します。
3. 入力の最初の文字がU+0023 NUMBER SIGN文字（＃）でない場合は、エラーを返します。
4. 入力の最後の6文字がすべてのASCII 16進数でない場合は、エラーを返します。
5. 結果を単純色とします
6. 2番目と3番目の文字を16進数として解釈し、結果を結果の赤の成分にします。
7. 4番目と5番目の文字を16進数として解釈し、結果を結果の緑の成分にします。
8. 6番目と7番目の文字を16進数として解釈し、結果を結果の青の成分にします。
9. 結果を返します。

- 与えられた単純色をシリアライズするための規則は、以下のアルゴリズムで与えられています：
1. 結果を、単一のU+0023 NUMBER SIGN文字からなる文字列とする
2. 赤、緑、青のコンポーネントを2桁の16進数に変換します。必要に応じて小文字のASCII16進数、ゼロ詰めをし、赤、緑、青の順に結果に追加します。
3. 戻り値は、有効な単純色(小文字)になります。

***

- 古くなったレガシー属性の中には、以下のアルゴリズムで示されている従来のカラー値を解析するための規則を使用して、より複雑な方法で色を解析します。
    - 呼び出されると、指定された順序でステップを実行し、値を返す最初のステップで中止しなければなりません。このアルゴリズムは、単純色かエラーのいずれかを返します。


1. inputを解析対象の文字列とします。
2. inputが空文字列の場合、エラーを返します。
3. inputからの先頭と末尾の空白を削除します。
4. inputが "transparent"と一致する場合(case-insensitive)、エラーを返します。
5. 入力が指定された色とcase-insensitveに一致する場合、そのキーワードに対応する単純な色を返します。
    - [CSS3COLOR](https://www.w3.org/TR/html/references.html#biblio-css3color)
    - note: CSS2システム色は認識されません。
6. inputが4文字で、inputの最初の文字がU+0023 NUMBER SIGN文字（#）で、入力の最後の3文字がすべてASCIIの16進数の場合、次のサブステップを実行します。
    1. 結果を単純色とします。
    2. inputの2番目の文字を16進数として解釈します。結果の赤の成分を結果の数に17を掛けたものにします。
    3. inputの3番目の文字を16進数として解釈します。結果の緑色成分を結果の数値に17を掛けたものにします。
    4. inputの4番目の文字を16進数として解釈します。 resultの青の成分を結果の数値に17を掛けたものにします。
    5. 結果を返します
7. inputのU+FFFFより大きいUnicodeコードポイント（つまり、基本多言語面にない文字）の全ての文字を2文字の文字列 "00"に置き換えます
8. inputが128文字を超える場合は、最初の128文字だけを残して入力を切り捨てます。
9. 入力の最初の文字がU + 0023 NUMBER SIGN文字（#）の場合は、それを削除します。
10. ASCII 16進数字以外の文字をU + 0030 DIGIT ZERO（0）の文字に置き換えます。
11. 入力の長さは0または3の倍数では無い場合、入力にはU+0030のDIGIT ZERO（0）文字を付加します。
12. inputを同じ長さの3つの文字列に分割し、3つのコンポーネントを取得します。長さは、これらのコンポーネントの長さ（inputの長さの3分の1）とします。
13. lengthが8より大きい場合、各コンポーネントの先頭の長さ-8文字を削除し、長さを8にします。
14. 長さが2より大きく、各コンポーネントの最初の文字がU+0030 DIGIT ZERO（0）文字である場合は、その文字を削除し、長さを1減らします。
15. 長さがまだ2より大きい場合は、各コンポーネントを切り捨て、最初の2文字のみを残します。
16. 結果を単純色とします。
17. 最初のコンポーネントを16進数として解釈します。結果の赤の成分を結果の数値にします。
18. 2番目のコンポーネントを16進数として解釈します。結果の緑色成分を結果の数値にします。
19. 3番目のコンポーネントを16進数として解釈します。 結果の青の成分を結果の数値にします。
20. 結果を返します
