# 4.2.5.5. Specifying the document’s character encoding

- 文字エンコーディング宣言は、文書の格納または送信に使用される文字エンコーディングが指定されるメカニズムです。

- 文字エンコード宣言には次の制限が適用されます。
    - 指定された文字エンコーディング名は、ファイルのシリアル化に使用される文字エンコーディングのラベルの1つに対して、ASCII case-insensitiveな一致でなければなりません。
    - 文字エンコード宣言は、文字参照やあらゆる種類の文字エスケープを使わずに直列化しなければなりません。
    - 文字エンコーディング宣言を含む要素は、ドキュメントの最初の1024バイト以内で完全にシリアル化されなければなりません。


- さらに、`<meta>`要素に関する多くの制限のために、ドキュメントごとに1つのメタベースの文字エンコード宣言しか存在できません。

- HTML文書がBOMで始まらず、そのエンコーディングがContent-Typeメタデータによって明示的に指定されておらず、文書がiframe srcdoc文書でない場合、使用される文字エンコーディングはASCII互換のエンコーディングでなければならず、エンコーディングは、http-equiv属性にエンコーディング宣言stateを持つ、またはcharset属性を持つmeta要素を使用して指定する必要があります。

***
### note

- US-ASCIIでも文字エンコーディングの宣言は必要です（Content-Typeメタデータ内またはファイル内で明示的に）
    - これは、ユーザーがフォームで入力した非ASCII文字、スクリプトによって生成されたURLなどを処理するために文字エンコードが必要なためです。
***

- ドキュメントがiframe srcdocドキュメントの場合、ドキュメントには文字エンコード宣言が含まれていてはなりません。
    - （この場合、ソースは`<iframe>`を含むドキュメントの一部であるため、既にデコードされています）。
- HTMLドキュメントに、http-equiv属性にエンコーディング宣言stateを持つ、またはcharset属性を持つmeta要素がある場合、使用される文字エンコーディングはASCII互換のエンコーディングでなければなりません。

- 作成者はUTF-8を使用する必要があります。適合性チェッカーは、レガシーエンコードを使用しないように著者に助言するかもしれません。
- オーサリングツールは、新しく作成されたドキュメントにUTF-8を使用するようにデフォルト設定する必要があります。
- 作成者は、WHATWGエンコーディング仕様で定義されていないエンコーディングを使用してはなりません。また、作成者はISO-2022-JPを使用すべきではありません。
    - [ENCODING](https://www.w3.org/TR/html/references.html#biblio-encoding)

***
### note
- WHATWGエンコーディング仕様で定義されていない一部のエンコーディングは0x20から0x7Eの範囲のバイトを使用すると、U+0020〜U+007Eの範囲にある対応する文字以外の文字をエンコードし、潜在的なセキュリティ上の脆弱性を表します。
- uaは、おそらく良質なプレーンテキストコンテンツをHTMLタグやJavaScriptとして解釈してしまうかもしれません。

- 非UTF-8エンコーディングを使用すると、デフォルトでドキュメントの文字エンコーディングを使用するフォーム提出とURLエンコーディングで予期しない結果が生じる可能性があります。
***

- XHTMLでは、必要に応じてインライン文字エンコーディング情報にXML宣言を使用する必要があります。


```html
<!-- 例15:
HTMLでは、文字エンコーディングがUTF-8であることを宣言するために、
著者はドキュメントの上部近くに次のマークアップを含めることができます
(head要素内)-->
<meta charset="utf-8">
<!-- XMLでは、マークアップの最上部にXML宣言が代わりに使用されます。 -->
<?xml version="1.0" encoding="utf-8"?>
```
