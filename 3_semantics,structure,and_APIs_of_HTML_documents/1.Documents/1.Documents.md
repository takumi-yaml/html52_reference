# 3.1. Documents

- HTML UAの中のすべてのXMLおよびHTMLドキュメントは、Documentオブジェクトで表されます。
    - [DOM41](https://www.w3.org/TR/html/references.html#biblio-dom)

- DocumentオブジェクトのURLは、DOM仕様で定義されています。
- Documentオブジェクトが作成されたときに最初に設定されますが、Documentオブジェクトの存続期間中に変更される可能性があります
    - たとえば、ユーザーがページ上のフラグメントに移動し、`pushState()`メソッドが新しいURLで呼び出されたときに変更されます。
    - [DOM41](https://www.w3.org/TR/html/references.html#biblio-dom)


- warning
    - 対話型のユーザーエージェントは、通常、ユーザーインターフェイスでDocumentオブジェクトのURLを公開します。
    - これは、サイトが別のものを偽装しようとしているかどうかをユーザーが判断できる主要なメカニズムです。

- `reateDocument()`または`createHTMLDocument()`APIを使用してスクリプトによってドキュメントが作成されると、ドキュメントはポストロードタスクの準備が整い、すぐに完全にロードされます。
- ドキュメントのリファラーは、ドキュメントの作成時に設定できる文字列（URLを表す）です。
    - 明示的に設定されていない場合、その値は空の文字列です。

- 各Documentオブジェクトには元々設定されていないリロードオーバーライドフラグがあります。
    - フラグは、特定の状況で`document.open()`および`document.write()`メソッドによって立てられます。
    - フラグが立てられている場合、ドキュメントにはリロードオーバーライドバッファもあります。リロードオーバーライドバッファは、再ロード時にドキュメントのソースとして使用されるUnicode文字列です。

- UAがソースブラウジングコンテキストを与えられた場合に、オーバーライドされたリロードを実行する場合、UAは以下のように動作しなければならない。
    1. sourceをブラウズコンテキストのアクティブドキュメントのリロードオーバーライドバッファの値にする。
    2. addressをブラウジングコンテキストのアクティブドキュメントのURLとします。
    3. HTTPS stateをブラウジングコンテキストのアクティブなドキュメントのHTTPS stateにします。
    4. 参照元ポリシーをブラウジングコンテキストのアクティブなドキュメントの参照元ポリシーにします。
    5. CSP listをブラウジングコンテキストのアクティブなドキュメントのCSP listにします。
    6. ブラウジングコンテキストをbodyがsourceで、headerリストの参照元ポリシーを参照元ポリシーに、CSP listをCSP listに、HTTPS stateをHTTPS stateにの新しいレスポンスに、例外有効フラグと置換有効フラグを立てて、ナビゲートします。
    7. この目的のためにNavigateアルゴリズムがDocumentオブジェクトを作成するときは、そのドキュメントのリロードオーバーライドフラグを設定し、リロードオーバーライドバッファをsourceに設定します。
        - 例外を再度スローします
        - ナビゲーションアルゴリズムでドキュメントのアドレスを設定するときは、アドレスをオーバーライドURLとして使用します。
